# Microservice(reza.jamali3)


**نمونه کد برای نقش Back - End**
<br>
**این یک صورت مساله از دنیای واقعی است  و تمام تفکرات و پیاده سازی ها توسط خودم انجام شده است. هرگونه مشابهت کد بدلیل استفاده از پترن کدها و استانداردهای کد میباشد.**

## پترن های استفاده شده در میکرو سرویس
(مواردی که روی آنها خط کشیده شده در حال انجام است)

**Decomposition Patterns      -   الگوهای تجزیه**
 <br>
•	Decompose by Business Capability -  تجزیه بر اساس قابلیت تجاری (~~Feature~~ - Transaction)  <br>
~~•	Decompose by Subdomain  -  تجزیه بر اساس ساب دامنه~~  <br>

**Integration Patterns - الگوهای یکپارچه سازی**
<br>
•	API Gateway Pattern -  الگوی دروازه API  <br>
•	Aggregator Pattern -   الگوی جمع کننده  <br>
•	Client-Side UI Composition Pattern -  الگوی ترکیب UI سمت کلاینت  <br>

 **Database Patterns - الگوهای پایگاه داده**
 <br>
•	Database per Service - پایگاه داده در هر سرویس  <br>
•	Shared Database per Service - پایگاه داده مشترک در هر سرویس  <br>
•	Command Query Responsibility Segregation (CQRS) -  تفکیک مسئولیت پرس و جو فرمان (CQRS) – ~~(Event Sourcing)~~
<br>
•	Saga Pattern - الگوی حماسه  <br>

 **Observability Patterns - الگوهای مشاهده پذیری**
 <br>
•	Log Aggregation -تجمیع ورود به سیستم   <br>
•	Performance Metrics -  معیارهای عملکرد  <br>
~~•	Distributed Tracing - ردیابی توزیع شده~~  <br>
~~•	Health Check - بررسی سلامت~~  <br>

 **Cross-Cutting Concern Patterns - الگوهای نگرانی متقابل**
 <br>
•	External Configuration -  پیکربندی خارجی  <br>
•	Service Discovery Pattern -  الگوی کشف خدمات  <br>
~~•	Circuit Breaker Pattern - الگوی مدار شکن~~  <br>
~~•	Blue-Green Deployment Pattern -  الگوی استقرار آبی-سبز~~  <br>

--------------------------------------------------------------------------------------------------------------


## نرم افزارها و پکیج های استفاده شده:

<br>**Language - زبان میزبان** : C#

<br>**DataBase - بانک اطلاعاتی** : Sql Server 2022
<br>
**ORM - واسط های بانک اطلاعاتی** : Microsoft.EntityFrameworkCore 7.0.12
<br>
و 1.7.0  DapperExtensions
<br>
(هر دو استفاده شدن بصورت هیبریدی)
<br>

**ApiGetWays** (تجمیع مسیر):Ocelot 20.0.0 <br>
**Api.Aggregator** : Client Service <br>
**Event.Bus** : <br>
RabbitMQ  <br>
Publisher And Receiver Client => MassTransit 8.1.1 <br>
MassTransit.AspNetCore 7.3.1 <br>
MassTransit.RabbitMQ 8.1.1 <br>

## معماری ساختار -  Clean Architecture
![Clean Architecture](https://i.postimg.cc/qMfzSqBd/Clean-Architecture-NET-Core.jpg)
 
## معماری کد :  

**Model Data** <br>
 TaxCar.Combinedstation.Core <br>
<br>
**Model Domain - DDD**
<br>
CarTax.Area.Domain <br>
CarTax.Car.Domain <br>
CarTax.City.Domain <br>
TaxCar.Publicholidays.Domain <br>
CarTax.Tax.Domain <br>
CarTax.CarType.Domain <br>
CarTax.Taxfreecar.Domain <br>

<br><br>

**• DDD (Domain-Driven Design) - تاکتیکال مورد استفاده + پترن ها** <br>
	

Ubiquitous Language - اصل همگانی زبان مشترک<br>
Bounded Context - تقسیم دامنه<br>
Context Mapping - اصل هماهنگی<br>
Aggregates - تجمیع <br>
Entities - موجودیت<br>
Value Objects – شی ارزش<br>
Events - رویدادها<br>
Domain Service– سرویس دامنه<br>
Repository – مخزن داده<br>
Policies – قوانین <br>
Version Control – کنترل ورژن<br>
Factory Class  - کارخانه سازنده<br>
Factory Method – کارخانه متد<br>
SnapShoot – عکس فوری<br>
Micro pattern – میکرو پترن ها<br>
private Setter – تغییر پذیر<br>
Behavior Modeling – مدل رفتار<br>
Complexity - داده های پیچیده <br>
Strategic Design - الگوی تفکر استراتژیک <br>

<br>

----------------------------------------------------------------------------------------------------------------


## عنوان مسائله: ماشین حساب مالیات ترافیک

### سناریو

همکار جوان شما در حال کار بر روی یک برنامه برای محاسبه هزینه‌های مالیات ترافیک برای خودروها در منطقه گوتنبرگ است و متأسفانه، این همکار به ترکیبی پدری رفته است. پروژه ناتمام همکار شما به این فایل الحاق شده است. هیچ خطاهای نحوی در کد الحاق شده وجود ندارد، اما به نظر می‌رسد دچار اشکالات در 
محاسبات و معماری شده است.
<br>
در دستگاه همکار خود می‌نگرید و لیستی از تاریخ‌ها را روی یک برگه چسبانده شده می‌یابید. شاید به دردتان بخورند.
<br>

"2013-01-14 21:00:00" <br>
"2013-01-15 21:00:00" <br>
"2013-02-07 06:23:27" <br>
"2013-02-07 15:27:00" <br>
"2013-02-08 06:27:00" <br>
"2013-02-08 06:20:27" <br>
"2013-02-08 14:35:00" <br>
"2013-02-08 15:29:00" <br>
"2013-02-08 15:47:00" <br>
"2013-02-08 16:01:00" <br>
"2013-02-08 16:48:00" <br>
"2013-02-08 17:49:00" <br>
"2013-02-08 18:29:00" <br>
"2013-02-08 18:35:00" <br>
"2013-03-26 14:25:00" <br>
"2013-03-28 14:07:27" <br>





### تکلیف
** ما می‌خواهیم شما از روی تفکر کنید و کد را به یک نسخه صحیح و تمیز تغییر دهید **
<br>
شما از پایگاه‌های داده رابطه‌ای استفاده می‌کنید <br>
(مانند sqlite، sql server، sqlite حافظه و غیره) <br>
<br>
شما می‌توانید دامنه را تا سال ۲۰2۳ محدود کنید. <br>

### قوانین مالیات ترافیک در گوتنبرگ
مالیات ترافیک در ساعات مشخصی برای خودروهایی که وارد و خارج از گوتنبرگ می‌شوند، دریافت می‌شود.
<br>
حداکثر مبلغ روزانه برای هر خودرو ۶۰ کرون سوئدی است.
<br>


این مالیات در روزهای آخر هفته (شنبه و یکشنبه)،
<br>
 تعطیلات عمومی،
 <br>
 روزهای قبل از تعطیلات عمومی
 <br>
 و طول ماه جولای دریافت نمی‌شود
 <br>
 <br>

#### ساعت‌ها و مبالغ مالیات ترافیک در گوتنبرگ
<br>
<br>
| زمان        |    | مبلغ 
<br>
| ----------- |                     :----: |
<br>
| ۰۶:۰۰–۰۶:۲۹ |   ۸ کرون سوئدی |
<br>
| ۰۶:۳۰–۰۶:۵۹ | ۱۳ کرون سوئدی |
<br>
| ۰۷:۰۰–۰۷:۵۹ | ۱۸ کرون سوئدی |
<br>
| ۰۸:۰۰–۰۸:۲۹ | ۱۳ کرون سوئدی |
<br>
| ۰۸:۳۰–۱۴:۵۹ |   ۸ کرون سوئدی |
<br>
| ۱۵:۰۰–۱۵:۲۹ | ۱۳ کرون سوئدی |
<br>
| ۱۵:۳۰–۱۶:۵۹ | ۱۸ کرون سوئدی |
<br>
| ۱۷:۰۰–۱۷:۵۹ | ۱۳ کرون سوئدی |
<br>
| ۱۸:۰۰–۱۸:۲۹ |   ۸ کرون سوئدی |
<br>
| ۱۸:۳۰–۰۵:۵۹ |   ۰ کرون سوئدی |
<br>

#### قانون یکبار مالیات
<br><br>

در گوتنبرگ قانون یکبار مالیات اعمال می‌شود. طبق این قانون، یک خودرویی که در ۶۰ دقیقه گذراژه‌ای چندین ایستگاه تلفیقی را طی کند، فقط یک بار مالیات می‌پردازد. مبلغی که باید پرداخت شود، بیشترین مبلغ است.
<br>

#### خودروهای معاف از مالیات

- خودروهای امداد و نجات
- اتوبوس‌ها
- خودروهای سفارتی
- موتورسیکلت‌ها
- خودروهای نظامی
- خودروهای خارجی

### سناریو امتیازی

همان زمانی که شما به کدنویسی پایان می‌دهید، مدیر شما ظاهر می‌شود و به شما می‌گوید که همان برنامه باید در شهرهای دیگر با قوانین مالیات متفاوت استفاده شود.
<br><br>

پارامترهای استفاده شده توسط برنامه را به یک فروشگاه داده خارجی انتخابی خود منتقل کنید تا در زمان اجرا توسط برنامه خوانده شوند.
<br>



